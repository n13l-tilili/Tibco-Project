<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Proc√©dures Clients</title>
<style>
    body { background-color: #0d1117; color: #c9d1d9; font-family: 'Segoe UI', sans-serif; margin: 0; }
    h1 { text-align: center; color: #58a6ff; margin: 20px 0; text-shadow: 0 0 10px #58a6ff; }
    .topbar { display: flex; justify-content: space-between; padding: 10px 20px; position: relative; }
    .menu-toggle {
      background: #161b22; color: #58a6ff; border: 2px solid #58a6ff;
      padding: 8px 14px; border-radius: 25px; cursor: pointer;
      box-shadow: 0 0 6px #58a6ff77;
    }
    .dropdown-menu {
      display: none; position: absolute; top: 45px; left: 20px;
      background: #161b22; border: 1px solid #58a6ff88; border-radius: 10px;
      box-shadow: 0 0 10px #58a6ff55; z-index: 1000;
    }
    .dropdown-menu button {
      display: block; width: 100%; background: transparent;
      border: none; padding: 10px 15px; color: #58a6ff;
      text-align: left; cursor: pointer;
    }
    .dropdown-menu button:hover { background-color: #21262d; }
    .search-bar { width: 90%; max-width: 400px; margin: 0 auto 20px auto; display: flex; justify-content: center; }
    .search-bar input {
      width: 100%; padding: 12px; font-size: 16px;
      border-radius: 30px; border: none;
      background-color: #161b22; color: #58a6ff;
      box-shadow: 0 0 10px #58a6ff55;
    }
    .clients { display: flex; flex-direction: column; align-items: center; gap: 20px; margin: 10px 20px; }
    .client-wrapper { text-align: center; position: relative; }
    .client-logo {
      width: 100px; height: 100px; object-fit: contain; cursor: pointer;
      border-radius: 12px; box-shadow: 0 0 10px #58a6ff99; transition: transform 0.2s;
    }
    .client-logo:hover { transform: scale(1.1); }
    .client-content {
      width: 90%; max-width: 500px; background: #161b22;
      margin: 10px auto 0 auto; border-radius: 10px; padding: 10px;
      display: none; animation: fadeSlide 0.4s ease-in-out forwards;
      box-shadow: 0 0 8px #58a6ff44;
    }
    @keyframes fadeSlide {
      0% { opacity: 0; transform: translateY(-10px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .category { background: #21262d; margin: 10px 0; padding: 10px; border-radius: 10px; position: relative; }
    .category h4 { margin: 0 0 6px 0; color: #58a6ff; }
    .procedure {
      background: #30363d; padding: 5px 10px; margin: 4px 0; border-radius: 6px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .procedure a { color: #58a6ff; text-decoration: none; }
    .delete-btn {
      background: red; border: none; color: white;
      border-radius: 10px; padding: 5px; margin-left: 10px;
      display: none; cursor: pointer; font-size: 12px;
    }
    .modal { display: none; position: fixed; z-index: 9999;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(6px);
    }
    .modal-content {
      background: #161b22; color: #fff; padding: 20px;
      border-radius: 10px; width: 90%; max-width: 400px;
      margin: 10% auto; position: relative;
    }
    .modal-content input {
      width: 100%; margin-bottom: 10px; padding: 10px; border-radius: 8px;
      border: none; background: #30363d; color: #fff;
    }
    .modal-content button { margin-top: 10px; }
    .close-btn {
      position: absolute; top: 10px; right: 12px;
      color: red; font-weight: bold; font-size: 18px; cursor: pointer;
    }
  
/* Style des modales modernes */
.modal-content h3 {
  color: #58a6ff;
  margin-bottom: 15px;
}
.modal-content input,
.modal-content select {
  margin-bottom: 12px;
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  background-color: #21262d;
  color: #58a6ff;
  border: none;
  font-size: 15px;
}
.modal-content button {
  background-color: #238636;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 10px;
  font-size: 15px;
  cursor: pointer;
  transition: background 0.3s ease;
}
.modal-content button:hover {
  background-color: #2ea043;
}

.clients {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  justify-items: center;
  align-items: start;
  gap: 20px;
  padding: 20px;
  max-width: 1000px;
  margin: auto;
}





.client-logo {
  background-color: rgba(200, 220, 255, 0.08);
  padding: 10px;
  border-radius: 12px;
  backdrop-filter: brightness(1.6) contrast(1.1);
}


/* Animation d'apparition modale */
@keyframes fadeZoomIn {
  0% {
    opacity: 0;
    transform: scale(0.85);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

.modal {
  background-color: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(5px);
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100%;
  height: 100%;
}

.modal-content {
  background-color: rgba(200, 220, 255, 0.08);
  margin: 5% auto;
  padding: 20px;
  border-radius: 14px;
  width: 90%;
  max-width: 700px;
  animation: fadeZoomIn 0.3s ease-out;
  box-shadow: 0 0 25px rgba(88, 166, 255, 0.3);
}

.modal-content h2 {
  font-size: 22px;
  margin-bottom: 10px;
}

.modal-content .category {
  margin-bottom: 18px;
  border-left: 4px solid #58a6ff;
  padding-left: 10px;
}

.modal-content .category h4 {
  color: #58a6ff;
  margin-bottom: 6px;
}

.modal-content .procedure {
  background-color: #2b2b2b;
  padding: 6px 10px;
  margin-bottom: 5px;
  border-radius: 8px;
  transition: background-color 0.2s;
}

.modal-content .procedure:hover {
  background-color: #3a3a3a;
}

.modal-content .procedure a {
  color: #ffffff;
  text-decoration: none;
}

.modal-content .close-btn {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 26px;
  color: #ff5f5f;
  cursor: pointer;
  transition: transform 0.2s;
}

.modal-content .close-btn:hover {
  transform: scale(1.2);
}
</style>
</head>
<body>
<div class="topbar">
<div class="dropdown-menu" id="menu">
<button onclick="openModal('client')">‚ûï Ajouter client</button>
<button onclick="openModal('category')">üìÇ Ajouter cat√©gorie</button>
<button onclick="openModal('procedure')">üìÑ Ajouter proc√©dure</button>
<button onclick="exportHTML()">üíæ Exporter</button>
<button onclick="document.getElementById('jsonInput').click()">üìÇ Importer</button>
<input accept=".json" id="jsonInput" onchange="importJSON(event)" style="display:none;" type="file"/>
<button onclick="toggleEdit()">üõ†Ô∏è Mode √©dition</button>
</div>
<button class="menu-toggle" onclick="toggleMenu()">‚öôÔ∏è</button>
</div>
<h1>üìò Proc√©dures par Client</h1>
<div class="search-bar">
<input id="searchInput" oninput="searchFilter()" placeholder="üîç Rechercher..." type="text"/>
</div>
<div class="clients" id="clientsContainer"></div>
<div class="modal" id="modal">
<div class="modal-content">
<span class="close-btn" onclick="closeModal()">√ó</span>
<div id="modalBody"></div>
</div>
</div>
<div class="modal" id="modalProcedure" style="display:none;">
<div class="modal-content">
<span class="close-btn" onclick="closeModal()">√ó</span>
<h3 style="color:#58a6ff;">Ajouter une proc√©dure</h3>
<select id="procClientSelect" onchange="updateCategorySelect()" style="margin-top:10px; width:100%; padding:10px; background:#21262d; color:white; border:none; border-radius:8px;"></select>
<select id="procCategorySelect" style="margin-top:10px; width:100%; padding:10px; background:#21262d; color:white; border:none; border-radius:8px;"></select>
<input id="procName" placeholder="Nom de la proc√©dure" style="margin-top:10px; width:100%; padding:10px; background:#21262d; color:white; border:none; border-radius:8px;" type="text"/>
<input id="procLink" placeholder="Lien de la proc√©dure" style="margin-top:10px; width:100%; padding:10px; background:#21262d; color:white; border:none; border-radius:8px;" type="text"/>
<button onclick="addProcedure()" style="margin-top:15px; background:#238636; color:white; border:none; padding:10px 20px; border-radius:8px;">Ajouter</button>
</div>
</div>
<script>
let clients = [{"name": "PMU", "logo": "https://upload.wikimedia.org/wikipedia/fr/thumb/a/aa/PMU.svg/1280px-PMU.svg.png", "categories": [{"name": "BORNE PMC", "procedures": []}, {"name": "BORNE IDEMIA", "procedures": []}, {"name": "TERMINAL", "procedures": []}, {"name": "EIPDV", "procedures": []}, {"name": "OTT", "procedures": []}, {"name": "TPLINK", "procedures": []}, {"name": "AUTRES", "procedures": []}]}, {"name": "NICKEL", "logo": "https://cdn.cookielaw.org/logos/716f7201-def5-41ba-bb74-b0904c984cda/5977cdf8-e8ac-43bd-bd0c-cf69aa2b429d/10ebcb46-878c-4ea6-b9d2-f4d84404e71d/Nickel_RVB_FondBlanc_Couleur-eps.png", "categories": [{"name": "BORNE", "procedures": []}, {"name": "TPE", "procedures": []}, {"name": "AUTRES", "procedures": []}]}, {"name": "RCBT BOUYGUES", "logo": "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Bouygues_Telecom_201x_logo.svg/960px-Bouygues_Telecom_201x_logo.svg.png", "categories": []}, {"name": "SEPHORA", "logo": "https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Sephora_logo.svg/1280px-Sephora_logo.svg.png", "categories": []}, {"name": "YVES ROCHER", "logo": "https://upload.wikimedia.org/wikipedia/fr/2/2d/Yves_Rocher_logo.svg", "categories": []}, {"name": "MACIF", "logo": "https://upload.wikimedia.org/wikipedia/fr/thumb/2/2a/Logo_Macif.svg/500px-Logo_Macif.svg.png?20191211002907", "categories": []}, {"name": "ARKEA", "logo": "https://upload.wikimedia.org/wikipedia/fr/thumb/2/21/Logo_Cr%C3%A9dit_mutuel_Ark%C3%A9a.svg/2560px-Logo_Cr%C3%A9dit_mutuel_Ark%C3%A9a.svg.png", "categories": []}, {"name": "BPMED", "logo": "https://upload.wikimedia.org/wikipedia/fr/thumb/4/49/Logo_Banque_Populaire_2018.svg/512px-Logo_Banque_Populaire_2018.svg.png?20181019210708", "categories": []}, {"name": "JULES", "logo": "https://cdn.worldvectorlogo.com/logos/logo-jules-1.svg", "categories": []}, {"name": "IKKS", "logo": "https://images.seeklogo.com/logo-png/36/2/ikks-logo-png_seeklogo-361080.png", "categories": []}, {"name": "CEPAC", "logo": "https://upload.wikimedia.org/wikipedia/fr/thumb/9/92/Logo_Caisse_d%27%C3%89pargne_-_2021.svg/700px-Logo_Caisse_d%27%C3%89pargne_-_2021.svg.png?20230131124740", "categories": []}, {"name": "CCOOP", "logo": "https://upload.wikimedia.org/wikipedia/fr/thumb/2/2e/Logo_Cr%C3%A9dit_Coop%C3%A9ratif.svg/1200px-Logo_Cr%C3%A9dit_Coop%C3%A9ratif.svg.png", "categories": []}, {"name": "CAMAIEU", "logo": "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/Cama%C3%AFeu_logo_%282017%29.svg/2560px-Cama%C3%AFeu_logo_%282017%29.svg.png", "categories": []}, {"name": "MY MONEY BANK", "logo": "https://upload.wikimedia.org/wikipedia/fr/thumb/1/1f/Logo_mmb_0.svg/2560px-Logo_mmb_0.svg.png", "categories": []}, {"name": "CREDIT AGRICOLE", "logo": "https://upload.wikimedia.org/wikipedia/fr/thumb/a/a6/Cr%C3%A9dit_Agricole.svg/2560px-Cr%C3%A9dit_Agricole.svg.png", "categories": []}];
let editing = false;
let selectedClientIndex = 0;

function toggleMenu() {
  const menu = document.getElementById("menu");
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

function toggleEdit() {
  editing = !editing;
  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.style.display = editing ? "inline-block" : "none";
  });
}

function saveAndRender() {
  render();
  bindClientLogoClicks();
}

function render() {
  const container = document.getElementById("clientsContainer");
  container.innerHTML = "";
  clients.forEach((client, cIdx) => {
    const wrapper = document.createElement("div");
    wrapper.className = "client-wrapper";
    const img = document.createElement("img");
    img.src = client.logo;
    img.alt = client.name;
    img.className = "client-logo";
    const delBtn = document.createElement("button");
    delBtn.textContent = "üóëÔ∏è";
    delBtn.className = "delete-btn";
    delBtn.onclick = () => {
      clients.splice(cIdx, 1);
      saveAndRender();
    };
    wrapper.appendChild(img);
    wrapper.appendChild(delBtn);
    container.appendChild(wrapper);
  });
  bindClientLogoClicks();
}

function bindClientLogoClicks() {
  document.querySelectorAll(".client-logo").forEach((logo, index) => {
    logo.onclick = () => showClientModal(index);
  });
}

render();
</script>
<script>
function openModal(type) {
  const modal = document.getElementById("modal");
  const modalBody = document.getElementById("modalBody");
  const modalProc = document.getElementById("modalProcedure");

  if (type === "procedure") {
    modal.style.display = "none";
    modalProc.style.display = "block";
    populateClientSelect();
  } else {
    modalProc.style.display = "none";
    modal.style.display = "block";
    if (type === "client") {
      modalBody.innerHTML = '<h3 style="color:#58a6ff;">Ajouter un client</h3>' +
        '<input id="clientName" placeholder="Nom du client">' +
        '<input id="clientLogo" placeholder="Lien du logo (URL)">' +
        '<button onclick="addClient()">Ajouter</button>';
    } else if (type === "category") {
      modalBody.innerHTML = '<h3 style="color:#58a6ff;">Ajouter une cat√©gorie</h3>' +
        '<input id="categoryName" placeholder="Nom de la cat√©gorie">' +
        '<select id="categoryClient"></select>' +
        '<button onclick="addCategory()">Ajouter</button>';
      populateClientSelect("categoryClient");
    }
  }
}

function populateClientSelect(selectId = "procClientSelect") {
  const select = document.getElementById(selectId);
  select.innerHTML = "";
  clients.forEach((client, index) => {
    const opt = document.createElement("option");
    opt.value = index;
    opt.textContent = client.name;
    select.appendChild(opt);
  });
  if (selectId === "procClientSelect") updateCategorySelect();
}

function updateCategorySelect() {
  const clientIndex = document.getElementById("procClientSelect").value;
  const categorySelect = document.getElementById("procCategorySelect");
  categorySelect.innerHTML = "";
  if (clients[clientIndex] && clients[clientIndex].categories) {
    clients[clientIndex].categories.forEach((cat, index) => {
      const opt = document.createElement("option");
      opt.value = index;
      opt.textContent = cat.name;
      categorySelect.appendChild(opt);
    });
  }
}





function addCategory() {
  const clientIndex = document.getElementById("categoryClient").value;
  const categoryName = document.getElementById("categoryName").value.trim();
  if (!categoryName) {
    alert("Le nom de la cat√©gorie est vide");
    return;
  }
  if (!clients[clientIndex].categories) clients[clientIndex].categories = [];
  clients[clientIndex].categories.push({ name: categoryName, procedures: [] });
  localStorage.setItem("clientsData", JSON.stringify(clients));
  render(); bindClientLogoClicks();
  closeModal();
}


function addProcedure() {
  const clientIndex = document.getElementById("procClientSelect").value;
  const catIndex = document.getElementById("procCategorySelect").value;
  const name = document.getElementById("procName").value.trim();
  const link = document.getElementById("procLink").value.trim();

  if (!name || !link) {
    alert("Nom ou lien manquant");
    return;
  }
  if (!clients[clientIndex] || !clients[clientIndex].categories[catIndex]) {
    alert("Client ou cat√©gorie invalide");
    return;
  }

  clients[clientIndex].categories[catIndex].procedures.push({ name, link });
  localStorage.setItem("clientsData", JSON.stringify(clients));
  render(); bindClientLogoClicks();
  closeModal();
}

</script><script>
function importJSON(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                clients = JSON.parse(e.target.result);
                localStorage.setItem("clientsData", JSON.stringify(clients));
                render(); bindClientLogoClicks();
                alert("‚úÖ Import r√©ussi !");
            } catch (error) {
                alert("‚ùå Erreur lors de l'import du fichier : " + error);
            }
        };
        reader.readAsText(file);
    }
}
</script>
<script>
function showClientModal(index) {
  const modal = document.getElementById("clientModal");
  const body = document.getElementById("clientModalBody");
  const client = clients[index];
  let html = "<h2 style='color:#58a6ff; text-align:center;'>" + client.name + "</h2>";
  html += "<img src='" + client.logo + "' style='display:block; margin: 10px auto; width:80px;' />";
  if (!client.categories || client.categories.length === 0) {
    html += "<p style='text-align:center;'>Aucune cat√©gorie.</p>";
  } else {
    client.categories.forEach((cat, catIdx) => {
      html += "<div class='category'><h4>" + cat.name + "</h4>";
      if (editing) {
        html += "<button class='delete-btn' onclick='deleteCategory(" + index + "," + catIdx + ")'>üóëÔ∏è</button>";
      }
      if (cat.procedures && cat.procedures.length > 0) {
        cat.procedures.forEach((proc, pIdx) => {
          html += "<div class='procedure'><a href='" + proc.link + "' target='_blank'>" + proc.name + "</a>";
          if (editing) {
            html += "<button class='delete-btn' onclick='deleteProcedure(" + index + "," + catIdx + "," + pIdx + ")'>üóëÔ∏è</button>";
          }
          html += "</div>";
        });
      } else {
        html += "<p style='margin-left:10px;'>Aucune proc√©dure.</p>";
      }
      html += "</div>";
    });
  }
  body.innerHTML = html;
  modal.style.display = "block";
}

function closeClientModal() {
  document.getElementById("clientModal").style.display = "none";
}

// R√©appliquer les √©v√©nements apr√®s le render()
function bindClientLogoClicks() {
  document.querySelectorAll(".client-logo").forEach((logo, index) => {
    logo.onclick = () => showClientModal(index);
  });
}

const originalRender = render;
render = function() {
  originalRender();
  bindClientLogoClicks();
};
</script>
<div class="modal" id="clientModal" style="display:none;">
<div class="modal-content" id="clientModalContent" style="max-height: 80vh; overflow-y: auto;">
<span class="close-btn" onclick="closeClientModal()">√ó</span>
<div id="clientModalBody"></div>
</div>
</div>
<script>
function showClientModal(index) {
  const modal = document.getElementById("clientModal");
  const body = document.getElementById("clientModalBody");
  const client = clients[index];
  let html = "<h2 style='color:#58a6ff; text-align:center;'>" + client.name + "</h2>";
  html += "<img src='" + client.logo + "' style='display:block; margin: 10px auto; width:80px;' />";
  if (!client.categories || client.categories.length === 0) {
    html += "<p style='text-align:center;'>Aucune cat√©gorie.</p>";
  } else {
    client.categories.forEach((cat, catIdx) => {
      html += "<div class='category'><h4>" + cat.name + "</h4>";
      if (editing) {
        html += "<button class='delete-btn' onclick='deleteCategory(" + index + "," + catIdx + ")'>üóëÔ∏è</button>";
      }
      if (cat.procedures && cat.procedures.length > 0) {
        cat.procedures.forEach((proc, pIdx) => {
          html += "<div class='procedure'><a href='" + proc.link + "' target='_blank'>" + proc.name + "</a>";
          if (editing) {
            html += "<button class='delete-btn' onclick='deleteProcedure(" + index + "," + catIdx + "," + pIdx + ")'>üóëÔ∏è</button>";
          }
          html += "</div>";
        });
      } else {
        html += "<p style='margin-left:10px;'>Aucune proc√©dure.</p>";
      }
      html += "</div>";
    });
  }
  body.innerHTML = html;
  modal.style.display = "block";
}

function closeClientModal() {
  document.getElementById("clientModal").style.display = "none";
}
</script></body>
</html>
