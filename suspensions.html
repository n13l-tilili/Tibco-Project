
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“‹ Mail Fin de JournÃ©e â€“ Suspensions</title>
  <style>
    body {
      background-color: #121212;
      color: #e0f7fa;
      font-family: "Segoe UI", sans-serif;
      padding: 40px;
    }
    h1 {
      text-align: center;
      color: #4fc3f7;
      margin-bottom: 20px;
    }
    textarea {
      width: 100%;
      height: 200px;
      background: #1f1f1f;
      color: white;
      border: 1px solid #4fc3f7;
      border-radius: 8px;
      padding: 10px;
      font-family: monospace;
    }
    .btn-row {
      text-align: center;
      margin-top: 20px;
    }
    button {
      background-color: #263238;
      color: #4fc3f7;
      border: 1px solid #4fc3f7;
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background-color: #37474f;
    }
    #mail-output {
      margin-top: 40px;
      background-color: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      box-shadow: inset 0 0 8px #4fc3f7;
      white-space: pre-wrap;
    }
    .mail-table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      font-family: 'Segoe UI', sans-serif;
      background-color: #1e1e1e;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 12px rgba(79, 195, 247, 0.2);
      color: white;
    }
    .mail-table th, .mail-table td {
      padding: 10px;
      border: 1px solid #4fc3f7;
      text-align: center;
    }
    .mail-table th {
      background-color: #263238;
      color: #4fc3f7;
      text-transform: uppercase;
    }
    #notif {
      display:none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #263238;
      color: #4fc3f7;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px #4fc3f7;
      font-size: 14px;
      z-index: 999;
    }
  </style>
</head>

<body>
  <div style="margin-bottom: 20px; padding: 15px; border-radius: 8px; background-color: #1e293b;
  color: #60a5fa; font-size: 14px; border: 1px solid #60a5fa; max-width: 800px; margin-left: auto; margin-right: auto;">
    âš ï¸ Ce gÃ©nÃ©rateur est uniquement destinÃ© Ã  informer la coordination et le RP de la situation des <strong>interventions PMU suspendues</strong>.
  </div>

  <h1>ğŸ“‹ Mail Fin de JournÃ©e â€“ Suspensions PMU</h1>
  <textarea id="codeInput" placeholder="Collez ici le ou les lignes Akuiteo..."></textarea>
  <div class="btn-row">
    <button onclick="generateMail()">ğŸ“¨ GÃ©nÃ©rer</button>
    <button onclick="copyMail()">ğŸ“‹ Copier</button>
    <button onclick="exportHTML()">ğŸ’¾ HTML</button>
  </div>

  <div id="notif">âœ… Mail copiÃ© !</div>
  <div id="mail-output"></div>

  <script>
    function parseLine(line) {
      const parts = line.split(';');
      return {
        akuiteo: parts[0] || 'â€”',
        site: parts[7] || 'â€”',
        ville: parts[10] || 'â€”',
        piece: parts[16] || 'â€”',
        technicien: parts[14] || 'Aucun technicien affectÃ©'
      };
    }

    function generateMail() {
      const input = document.getElementById("codeInput").value.trim();
      const lines = input.split('\n').filter(l => l.trim() !== '');
      const rows = lines.map(parseLine);

      let mail = `
<div style="font-family: 'Segoe UI', sans-serif; color: white; line-height: 1.1;">
  Bonjour StÃ©phanie,<br>
  ğŸ”” Voici le suivi des interventions suspendues Ã  ce jour ğŸ˜Š<br>
  ğŸ“Œ ${rows.length} intervention(s) enregistrÃ©es<br>
  ğŸ‘·â€â™‚ï¸ ${rows.filter(r => r.technicien !== 'Aucun technicien affectÃ©').length} intervention(s) avec technicien affectÃ©.<br>
  ${
    rows
      .filter(r => r.technicien !== 'Aucun technicien affectÃ©')
      .map(r => `ğŸ”§ ${r.technicien} est affectÃ© Ã  lâ€™intervention ${r.akuiteo} Ã  ${r.ville}`)
      .join('<br>')
  }<br>
  <table class="mail-table">
    <thead>
      <tr><th>ğŸ“„ NÂ° Akuiteo</th><th>ğŸ¢ Site</th><th>ğŸ“ Ville</th><th>ğŸ”© PiÃ¨ce</th><th>ğŸ‘¨â€ğŸ”§ Technicien</th></tr>
    </thead>
    <tbody>
      ${rows.map(r => `<tr><td>${r.akuiteo}</td><td>${r.site}</td><td>${r.ville}</td><td>${r.piece}</td><td>${r.technicien}</td></tr>`).join('')}
    </tbody>
  </table><br>
  ğŸ¤— TrÃ¨s bonne fin de journÃ©e Ã  vous.
</div>`;
      document.getElementById("mail-output").innerHTML = mail;
    }

    function copyMail() {
      const content = document.getElementById('mail-output').innerHTML;
      const blob = new Blob([content], { type: 'text/html' });
      const data = [new ClipboardItem({ 'text/html': blob })];
      navigator.clipboard.write(data).then(() => {
        showNotif("âœ… Mail copiÃ© !");
      });
    }

    function exportHTML() {
      const content = document.getElementById('mail-output').innerHTML;
      const blob = new Blob([content], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "mail_suspensions.html";
      a.click();
      showNotif("ğŸ’¾ Export HTML prÃªt !");
    }

    function showNotif(text) {
      const notif = document.getElementById("notif");
      notif.textContent = text;
      notif.style.display = "block";
      setTimeout(() => { notif.style.display = "none"; }, 3000);
    }
  </script>
</body>
</html>
