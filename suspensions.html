<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“‹ Mail Fin de JournÃ©e â€“ Suspensions</title>
  <style>
    body {
      background-color: #0e0e0e;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      padding: 40px;
    }

    textarea {
      width: 100%;
      height: 200px;
      background: #1f1f1f;
      color: white;
      border: 1px solid #00bfff;
      border-radius: 8px;
      padding: 10px;
      font-family: monospace;
    }

    .btn-row {
      text-align: center;
      margin-top: 20px;
    }

    button {
      background-color: #00bfff;
      color: white;
      padding: 12px 24px;
      font-size: 15px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 8px;
      box-shadow: 0 0 10px #00bfff88;
      transition: 0.3s;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 16px #00bfffcc;
    }

    #notif {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #00bfff;
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 14px;
      box-shadow: 0 0 10px #00bfffaa;
      z-index: 999;
    }

    #mail-output {
      margin-top: 30px;
    }
  </style>
</head>
<body>

<h1 style="text-align:center; color:#00bfff;">ğŸ“‹ Mail Fin de JournÃ©e â€“ Suspensions PMU</h1>

<div style="text-align: center; margin-top: -10px; margin-bottom: 30px;">
  <span style="display: inline-block; background: rgba(0,191,255,0.08); padding: 12px 24px; border-radius: 12px; box-shadow: 0 0 8px rgba(0,191,255,0.4); color: #aee4ff; font-size: 15px;">
    ğŸ”· Cette page est dÃ©diÃ©e Ã  lâ€™envoi dâ€™un message au RO/RP (Coordination PMU) pour le suivi des interventions suspendues Ã  ce jour.
  </span>
</div>


<textarea id="codeInput" placeholder="Collez ici le ou les lignes Akuiteo..."></textarea>

<div class="btn-row">
  <button onclick="generateMail()">ğŸ“¨ GÃ©nÃ©rer</button>
  <button onclick="copyMail()">ğŸ“‹ Copier le mail</button>
</div>

<div id="notif">âœ… Mail copiÃ© avec le style !</div>
<div id="mail-output"></div>

<script>
  function parseLine(line) {
    const parts = line.split(';');
    return {
      akuiteo: parts[0] || 'â€”',
      site: parts[7] || 'â€”',
      ville: parts[10] || 'â€”',
      piece: parts[16] || 'â€”',
      technicien: parts[14] || 'Aucun technicien affectÃ©'
    };
  }

  function generateMail() {
    const input = document.getElementById("codeInput").value.trim();
    const lines = input.split('\n').filter(l => l.trim() !== '');
    const rows = lines.map(parseLine);
    const countAffected = rows.filter(r => r.technicien !== 'Aucun technicien affectÃ©');

    let html = `
<div style="background:#111; padding: 30px; border-radius: 16px; box-shadow: 0 0 16px rgba(0,191,255,0.5); max-width:800px; margin:auto; font-family: 'Segoe UI', sans-serif; color: white; line-height: 1.6;">
  Bonjour StÃ©phanie,<br><br>
  ğŸ”” Voici le suivi des interventions suspendues Ã  ce jour ğŸ˜Š<br>
  ğŸ“Œ ${rows.length} intervention(s) enregistrÃ©es<br>
  ğŸ‘·â€â™‚ï¸ ${countAffected.length} intervention(s) avec technicien affectÃ©.<br><br>
  ${countAffected.map(r => `ğŸ”§ ${r.technicien} est affectÃ© Ã  lâ€™intervention ${r.akuiteo} Ã  ${r.ville}`).join('<br>')}<br><br>
  <table style="width:100%; border-collapse:collapse; margin-top:15px; box-shadow: 0 0 10px rgba(0,191,255,0.3); border-radius: 10px; overflow: hidden;">
    <thead>
      <tr style="background-color:#1e1e1e; color:#00bfff;">
        <th style="border:1px solid #333; padding:12px;">ğŸ“„ NÂ° Akuiteo</th>
        <th style="border:1px solid #333; padding:12px;">ğŸ¢ Site</th>
        <th style="border:1px solid #333; padding:12px;">ğŸ“ Ville</th>
        <th style="border:1px solid #333; padding:12px;">ğŸ”© PiÃ¨ce</th>
        <th style="border:1px solid #333; padding:12px;">ğŸ‘¨â€ğŸ”§ Technicien</th>
      </tr>
    </thead>
    <tbody>
      ${rows.map(r => `<tr><td style="border:1px solid #333; padding:12px; background-color:#181818; color:white;">${r.akuiteo}</td><td style="border:1px solid #333; padding:12px; background-color:#181818; color:white;">${r.site}</td><td style="border:1px solid #333; padding:12px; background-color:#181818; color:white;">${r.ville}</td><td style="border:1px solid #333; padding:12px; background-color:#181818; color:white;">${r.piece}</td><td style="border:1px solid #333; padding:12px; background-color:#181818; color:white;">${r.technicien}</td></tr>`).join('')}
    </tbody>
  </table><br>
  ğŸ¤— TrÃ¨s bonne fin de journÃ©e Ã  vous.
</div>`;
    document.getElementById("mail-output").innerHTML = html;
  }

  function copyMail() {
    const html = document.getElementById("mail-output").innerHTML;
    const blob = new Blob([`<html><head><meta charset='utf-8'></head><body>${html}</body></html>`], { type: "text/html" });
    const data = [new ClipboardItem({ "text/html": blob })];
    navigator.clipboard.write(data).then(() => {
      const notif = document.getElementById("notif");
      notif.style.display = "block";
      setTimeout(() => { notif.style.display = "none"; }, 2500);
    }).catch(err => {
      alert("Erreur de copie : " + err);
    });
  }
</script>

</body>
</html>
