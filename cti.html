<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expédition : INTER CTI</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #1e1e26;
      color: #e0e6ed;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      color: #4fc3f7;
    }
    label {
      display: block;
      margin-bottom: 0.3rem;
    }
    input, textarea {
      width: 100%;
      padding: 0.6rem 0.8rem;
      background-color: #2a2f38;
      border: 1px solid #4fc3f7;
      border-radius: 8px;
      color: #e0e6ed;
      font-size: 1rem;
    }
    textarea {
      resize: vertical;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      margin-bottom: 1.5rem;
    }
    .row > div {
      flex: 1;
      min-width: 280px;
    }
    .toggle-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 1rem 0;
      padding: 0.6rem 1rem;
      background-color: #2a2f38;
      border: 1px solid #4fc3f7;
      border-radius: 10px;
    }
    .toggle-wrapper label:first-child {
      font-weight: 600;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #555;
      transition: .4s;
      border-radius: 34px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    .switch input:checked + .slider {
      background-color: #4fc3f7;
    }
    .switch input:checked + .slider:before {
      transform: translateX(24px);
    }
    .hidden-field {
      display: none;
      margin-top: -1rem;
    }
    .btn {
      margin-top: 1.5rem;
      padding: 0.7rem 1.5rem;
      background-color: #4fc3f7;
      border: none;
      color: #1c1f26;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    .btn:hover {
      background-color: #29b6f6;
    }
    

.mail-preview {
  all: unset;
  display: block;
}
    
    
    .actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    table.mail-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #4fc3f7;
    }
    table.mail-table th, table.mail-table td {
      padding: 0.6rem 1rem;
      text-align: left;
    }
    table.mail-table th {
      background-color: #3c4552;
      color: #4fc3f7;
    }
    table.mail-table td {
      background-color: #252932;
    }
  </style>
</head>
<body>
  <h1>📦 Expédition : INTER CTI</h1>

  <div class="row">
    <div>
      <label for="intervention">📌 N° Intervention :</label>
      <input type="text" id="intervention" placeholder="Ex. E1234567" />
    </div>
    <div>
      <label for="serie">🔒 Numéro de série :</label>
      <input type="text" id="serie" placeholder="Ex. S/N123456" />
    </div>
  </div>

  <div class="row">
    <div>
      <label for="bon">🚚 Bon de transport :</label>
      <input type="text" id="bon" placeholder="Ex. TNT123456" />
    </div>
    <div>
      <label for="destination">🎯 Destination :</label>
      <input type="text" id="destination" placeholder="Ex. Coordination PMU" />
    </div>
  </div>

  <div class="toggle-wrapper">
    <label>👤 Nom</label>
    <label class="switch">
      <input type="checkbox" id="toggleNom" onchange="toggleField('nom')">
      <span class="slider"></span>
    </label>
  </div>
  <div id="container-nom" class="hidden-field">
    <input type="text" id="nom" placeholder="Ex. Niellini" />
  </div>

  <div class="toggle-wrapper">
    <label>🔐 Identifiant Tibco</label>
    <label class="switch">
      <input type="checkbox" id="toggleIdentifiant" onchange="toggleField('identifiant')">
      <span class="slider"></span>
    </label>
  </div>
  <div id="container-identifiant" class="hidden-field">
    <input type="text" id="identifiant" placeholder="Ex. 24891" />
  </div>

  <label for="texte-entete">✏️ Texte d'en-tête :</label>
  <textarea id="texte-entete" rows="4">Bonjour,<br>😊 Merci de bien vouloir procéder à l’expédition suivante.<br>Le matériel est prêt à être pris en charge par le transporteur (TNT).</textarea>

  <div class="actions">
    <button class="btn" onclick="genererMail()">✨ Générer le mail</button>
    <button class="btn" onclick="copierMail()">📋 Copier</button>
    <button class="btn" onclick="telechargerMail()">💾 Télécharger</button>
  </div>

  <div id="preview" class="mail-preview" style="margin-top: 2rem;"></div>

  <script>
    function toggleField(id) {
      const container = document.getElementById('container-' + id);
      const checkbox = document.getElementById('toggle' + capitalize(id));
      container.style.display = checkbox.checked ? 'block' : 'none';
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    window.onload = () => {
      document.getElementById('toggleNom').checked = false;
      document.getElementById('toggleIdentifiant').checked = false;
      toggleField('nom');
      toggleField('identifiant');
    }

    function genererMail() {
      const nom = document.getElementById('nom').value.trim();
      const identifiant = document.getElementById('identifiant').value.trim();
      const intervention = document.getElementById('intervention').value.trim();
      const serie = document.getElementById('serie').value.trim();
      const bon = document.getElementById('bon').value.trim();
      const destination = document.getElementById('destination').value.trim();
      const texte = document.getElementById('texte-entete').value.trim().replace(/\n/g, '<br>');

      let html = `
        <div style="width:560px;background:#1c1f26;border:1px solid #4fc3f7;box-shadow:0 0 20px #4fc3f7;padding:2rem;border-radius:18px;color:#e0e6ed;margin:auto;font-family:Segoe UI,sans-serif;overflow:hidden;box-sizing:border-box;"color:#e0e6ed;padding:2rem;border-radius:20px;border:2px solid #4fc3f7;box-shadow:0 0 30px #4fc3f799;">
          <p>${texte}</p>
          <table style="width:94%;margin:auto;border-collapse:collapse;table-layout:fixed;border:1px solid #4fc3f7;border-radius:12px;overflow:hidden;">
            <tbody>
              ${intervention ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">📌 N° Intervention</th><td style="background:#262b33;padding:10px;">${intervention}</td></tr>` : ''}
              ${serie ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">🔒 Numéro de série</th><td style="background:#262b33;padding:10px;">${serie}</td></tr>` : ''}
              ${bon ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">🚚 Bon de transport</th><td style="background:#262b33;padding:10px;">${bon}</td></tr>` : ''}
              ${destination ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">🎯 Destination</th><td style="background:#262b33;padding:10px;">${destination}</td></tr>` : ''}
              ${document.getElementById('toggleNom').checked ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">👤 Nom</th><td style="background:#262b33;padding:10px;">${nom || '(non renseigné)'}</td></tr>` : ''}
              ${document.getElementById('toggleIdentifiant').checked ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">🔐 Identifiant Tibco</th><td style="background:#262b33;padding:10px;">${identifiant || '(non renseigné)'}</td></tr>` : ''}
            </tbody>
          </table>
          <p style="margin-top:1rem">Merci pour le traitement <span style="font-size:1.2em">🙏</span></p>
        </div>`;

      document.getElementById('preview').innerHTML = html;
    }

    function copierMail() {
      const preview = document.getElementById('preview');
      const styles = Array.from(document.querySelectorAll('style')).map(s => s.innerHTML).join("\n");
      const html = `<html><head><style>${styles}</style></head><body>${preview.outerHTML}</body></html>`;
      const blob = new Blob([html], { type: 'text/html' });
      const item = new ClipboardItem({ 'text/html': blob });
      navigator.clipboard.write([item]).then(() => alert('✅ Mail copié avec style !'));
    }

    function telechargerMail() {
      const preview = document.getElementById('preview');
      const html = `<!DOCTYPE html><html><body>${preview.outerHTML}</body></html>`;
      const blob = new Blob([html], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "mail_inter_cti.html";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
