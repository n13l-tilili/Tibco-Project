<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Expédition : INTER CTI</title>
<style>
body {
  background-color: #121212;
  color: #e0f7fa;
  font-family: "Segoe UI", sans-serif;
  padding: 40px;
}
h1 {
  text-align: center;
  color: #4fc3f7;
  margin-bottom: 30px;
}
.modale-wrapper {
  max-width: 700px;
  margin: auto;
  background-color: #1f1f1f;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(79,195,247,0.3);
}
label {
  display: block;
  margin: 14px 0 6px;
  font-weight: bold;
  color: #4fc3f7;
}
input[type="text"] {
  width: 100%;
  padding: 10px;
  background-color: #2c2c2c;
  border: 1px solid #4fc3f7;
  border-radius: 8px;
  color: white;
}
.switch-row {
  display: flex;
  align-items: center;
  margin-top: 20px;
  margin-bottom: 20px;
  gap: 10px;
}
.toggle-label {
  color: #4fc3f7;
  font-weight: bold;
}
input[type="checkbox"] {
  accent-color: #4fc3f7;
  width: 18px;
  height: 18px;
}
button {
  background-color: #263238;
  color: #4fc3f7;
  border: 1px solid #4fc3f7;
  border-radius: 8px;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
  transition: 0.3s;
  margin: 5px;
}
button:hover {
  background-color: #37474f;
}
#mail-preview {
  margin-top: 30px;
  background-color: #1e1e1e;
  padding: 20px;
  border-radius: 12px;
  box-shadow: inset 0 0 8px #4fc3f7;
  white-space: pre-wrap;
  color: white;
}
.mail-table {
  width: 100%;
  margin-top: 20px;
  border-collapse: collapse;
  background-color: #1e1e1e;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 12px rgba(79, 195, 247, 0.2);
  color: white;
}
.mail-table th, .mail-table td {
  padding: 14px;
  border: 1px solid #4fc3f7;
  text-align: center;
}
.mail-table th {
  background-color: #263238;
  color: #4fc3f7;
  text-transform: uppercase;
}
</style><style>
.modale-wrapper {
  max-width: 800px;
  margin: 40px auto;
  padding: 40px;
  border-radius: 20px;
  background: #1a1a1a;
  box-shadow: 0 0 25px rgba(30, 144, 255, 0.5);
  border: 1px solid #4fc3f7;
}
input, textarea, select {
  width: 100%;
  padding: 12px;
  margin-bottom: 20px;
  border-radius: 10px;
  border: 1px solid #334155;
  background-color: #0f172a;
  color: #f8fafc;
  font-size: 15px;
  transition: border 0.3s ease;
}
input:focus, textarea:focus, select:focus {
  border: 1px solid #4fc3f7;
  outline: none;
}

.switch {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 26px;
  margin-left: 10px;
}
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #334155;
  transition: 0.4s;
  border-radius: 34px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: 0.4s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: #4fc3f7;
}
input:checked + .slider:before {
  transform: translateX(22px);
}

.copy-export-btn {
  background-color: #4fc3f7;
  color: #0f172a;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  padding: 10px 20px;
  margin: 10px;
  cursor: pointer;
  box-shadow: 0 0 12px #4fc3f7aa;
  transition: background-color 0.3s;
}
.copy-export-btn:hover {
  background-color: #38bdf8;
}
#notif {
  position: fixed;
  bottom: 25px;
  left: 25px;
  background-color: #4fc3f7;
  color: #0f172a;
  padding: 12px 20px;
  border-radius: 12px;
  font-weight: bold;
  display: none;
  z-index: 999;
}

.info-banner {
  background-color: #1e293b;
  color: #4fc3f7;
  padding: 15px 25px;
  font-size: 15px;
  border-left: 5px solid #4fc3f7;
  border-radius: 12px;
  margin-bottom: 30px;
  font-weight: bold;
  box-shadow: 0 0 10px rgba(79, 195, 247, 0.3);
}

</style></head>
<body><div class="modale-wrapper"><div class="info-banner">ℹ️ Ce générateur de mail est destiné aux envois de matériel entre CTI Tibco, que ce soit pour le PMU ou tout autre client.</div>
<h1>📦 Expédition : INTER CTI</h1>
<div class="row">
<div>
<label for="intervention">📌 N° Intervention :</label>
<input id="intervention" placeholder="Ex. E1234567" type="text"/>
</div>
<div>
<label for="serie">🔒 Numéro de série :</label>
<input id="serie" placeholder="Ex. S/N123456" type="text"/>
</div>
</div>
<div class="row">
<div>
<label for="bon">🚚 Bon de transport :</label>
<input id="bon" placeholder="Ex. TNT123456" type="text"/>
</div>
<div>
<label for="destination">🎯 Destination :</label>
<input id="destination" placeholder="Ex. Coordination PMU" type="text"/>
</div>
</div>
<div class="toggle-wrapper">
<label style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:25px;">👤 Nom</label>
<label class="switch">
<input id="toggleNom" onchange="toggleField('nom')" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="hidden-field" id="container-nom">
<input id="nom" placeholder="Ex. Niellini" type="text"/>
</div>
<div class="toggle-wrapper">
<label style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:25px;">🔐 Identifiant Tibco</label>
<label class="switch">
<input id="toggleIdentifiant" onchange="toggleField('identifiant')" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="hidden-field" id="container-identifiant">
<input id="identifiant" placeholder="Ex. 24891" type="text"/>
</div>
<label for="texte-entete">✏️ Texte d'en-tête :</label>
<textarea id="texte-entete" rows="4">Bonjour,<br/>😊 Merci de bien vouloir procéder à l’expédition suivante.<br/>Le matériel est prêt à être pris en charge par le transporteur (TNT).</textarea>
<div class="actions">
<button class="btn" onclick="genererMail()">✨ Générer le mail</button>
<button class="btn" onclick="copierMail()">📋 Copier</button>
<button class="btn" onclick="telechargerMail()">💾 Télécharger</button>
</div>
<div class="mail-preview" id="preview" style="margin-top: 2rem;"></div>
<script>
    function toggleField(id) {
      const container = document.getElementById('container-' + id);
      const checkbox = document.getElementById('toggle' + capitalize(id));
      container.style.display = checkbox.checked ? 'block' : 'none';
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    window.onload = () => {
      document.getElementById('toggleNom').checked = false;
      document.getElementById('toggleIdentifiant').checked = false;
      toggleField('nom');
      toggleField('identifiant');
    }

    function genererMail() {
      const nom = document.getElementById('nom').value.trim();
      const identifiant = document.getElementById('identifiant').value.trim();
      const intervention = document.getElementById('intervention').value.trim();
      const serie = document.getElementById('serie').value.trim();
      const bon = document.getElementById('bon').value.trim();
      const destination = document.getElementById('destination').value.trim();
      const texte = document.getElementById('texte-entete').value.trim().replace(/\n/g, '<br>');

      let html = `
        <div style="width:560px;background:#1c1f26;border:1px solid #4fc3f7;box-shadow:0 0 20px #4fc3f7;padding:2rem;border-radius:18px;color:#e0e6ed;margin:auto;font-family:Segoe UI,sans-serif;overflow:hidden;box-sizing:border-box;"color:#e0e6ed;padding:2rem;border-radius:20px;border:2px solid #4fc3f7;box-shadow:0 0 30px #4fc3f799;">
          <p>${texte}</p>
          <table style="width:94%;margin:auto;border-collapse:collapse;table-layout:fixed;border:1px solid #4fc3f7;border-radius:12px;overflow:hidden;">
            <tbody>
              ${intervention ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">📌 N° Intervention</th><td style="background:#262b33;padding:10px;">${intervention}</td></tr>` : ''}
              ${serie ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">🔒 Numéro de série</th><td style="background:#262b33;padding:10px;">${serie}</td></tr>` : ''}
              ${bon ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">🚚 Bon de transport</th><td style="background:#262b33;padding:10px;">${bon}</td></tr>` : ''}
              ${destination ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">🎯 Destination</th><td style="background:#262b33;padding:10px;">${destination}</td></tr>` : ''}
              ${document.getElementById('toggleNom').checked ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">👤 Nom</th><td style="background:#262b33;padding:10px;">${nom || '(non renseigné)'}</td></tr>` : ''}
              ${document.getElementById('toggleIdentifiant').checked ? `<tr><th style="background:#2e3a46;color:#4fc3f7;text-align:left;padding:10px;">🔐 Identifiant Tibco</th><td style="background:#262b33;padding:10px;">${identifiant || '(non renseigné)'}</td></tr>` : ''}
            </tbody>
          </table>
          <p style="margin-top:1rem">Merci pour le traitement <span style="font-size:1.2em">🙏</span></p>
        </div>`;

      document.getElementById('preview').innerHTML = html;
    }

    function copierMail() {
      const preview = document.getElementById('preview');
      const styles = Array.from(document.querySelectorAll('style')).map(s => s.innerHTML).join("\n");
      const html = `<html><head><style>${styles}</style></head><body>${preview.outerHTML}</body></html>`;
      const blob = new Blob([html], { type: 'text/html' });
      const item = new ClipboardItem({ 'text/html': blob });
      navigator.clipboard.write([item]).then(() => alert('✅ Mail copié avec style !'));
    }

    function telechargerMail() {
      const preview = document.getElementById('preview');
      const html = `<!DOCTYPE html><html><body>${preview.outerHTML}</body></html>`;
      const blob = new Blob([html], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "mail_inter_cti.html";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</div>
<div class="notification hidden" id="notif">✅ Action réalisée avec succès !</div>
<script>
function showNotif(msg) {
  const notif = document.getElementById("notif");
  notif.textContent = msg;
  notif.classList.add("show");
  notif.classList.remove("hidden");
  setTimeout(() => {
    notif.classList.remove("show");
    notif.classList.add("hidden");
  }, 2000);
}

// Attacher showNotif à la fonction de copie
document.addEventListener("DOMContentLoaded", () => {
  const copyBtn = document.getElementById("copy-button");
  if (copyBtn) {
    copyBtn.addEventListener("click", () => {
      const mail = document.getElementById("mail-preview");
      const range = document.createRange();
      range.selectNodeContents(mail);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand("copy");
        showNotif("✅ Mail copié avec style !");
      } catch (err) {
        showNotif("❌ Échec de la copie");
      }
      selection.removeAllRanges();
    });
  }
});
</script>
</body>
</html>
